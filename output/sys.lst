C51 COMPILER V9.60.0.0   SYS                                                               08/17/2021 17:42:15 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE SYS
OBJECT MODULE PLACED IN ..\output\sys.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\user\sys\sys.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(..\o
                    -utput\sys.lst) TABS(2) OBJECT(..\output\sys.obj)

line level    source

   1          /*********************************************************************/
   2          /*公司名称： 深圳市朗科智能电气股份有限公司                          */
   3          /*模 块 名： 系统模块                                                */
   4          /*创 建 人： LICHAOFAN     日期：2021-08-13                          */
   5          /*修 改 人： LICHAOFAN     日期：2021-08-13                          */
   6          /*功能描述： 提供定时，延时，信号抓取，信号处理                */
   7          /*其他说明：                                                         */
   8          /*版本：                                                             */
   9          /*********************************************************************/
  10          
  11          #include <SN8F5702.h>
  12          /********************************定义全局位变量***********************/
  13          bit PinFlag;
  14          
  15          /********************************定义全局字节变量*********************/
  16          extern unsigned int PinT;
  17          extern unsigned char Level,PinBit;
  18          
  19          /*********************************************************************
  20          * 函 数 名： InitT0T1
  21          * 功能描述： 对定时器初始化
  22          * 函数说明： 定时器初始化函数
  23          * 调用函数： 
  24          * 全局变量：
  25          * 输 入： 无
  26          * 返 回： 无
  27          * 设 计 者：LICHAOFAN 日期：2021-08-13
  28          * 修 改 者：LICHAOFAN 日期：2021-08-13
  29          /*版本：
  30          /**********************************************************************/
  31          void InitT0T1(void)
  32          { 
  33   1        TH1   = 0x9b;          //装入初值
  34   1        TL1   = 0x9b;
  35   1        TH0   = 0x9B;          //装入初值
  36   1        TL0   = 0x9B;
  37   1        TMOD  = 0x66;          //使用T0 T1 自动装填模式
  38   1        TCON0 = 0x22;          //外分频控制 /32
  39   1        TCON  = 0x50;          //启动定时器T0 T1 的功能控制位
  40   1        IEN0  = 0x8A;          //使能中断
  41   1      }
  42          
  43          
  44          /*********************************************************************
  45          * 函 数 名： InitT2
  46          * 功能描述： 对定时器t2初始化
  47          * 函数说明： 定时器t2初始化函数
  48          * 调用函数： 
  49          * 全局变量：
  50          * 输 入： 无
  51          * 返 回： 无
  52          * 设 计 者：LICHAOFAN 日期：2021-08-16
  53          * 修 改 者：LICHAOFAN 日期：2021-08-16
  54          /*版本：
C51 COMPILER V9.60.0.0   SYS                                                               08/17/2021 17:42:15 PAGE 2   

  55          /**********************************************************************/
  56          void InitT2(void)
  57          { 
  58   1        TH2 = 0xE5;           //定时2.5ms
  59   1        TL2 = 0xF5;
  60   1        T2CON = 0x00;
  61   1        IEN0 |= 0xA0;         //使能T2中断
  62   1      
  63   1      }      
  64          /*********************************************************************
  65          * 函 数 名： T2Interrupt
  66          * 功能描述： 输出2.5ms低电平
  67          * 函数说明： T2中断处理函数
  68          * 调用函数： 
  69          * 全局变量：
  70          * 输 入： 无
  71          * 返 回： 无
  72          * 设 计 者：LICHAOFAN 日期：2021-08-13
  73          * 修 改 者：LICHAOFAN 日期：2021-08-13
  74          /*版本：
  75          /**********************************************************************/
  76          void T2Interrupt(void) interrupt ISRTimer2
  77          {   static bit MotorFlag;
  78   1          TH2 = 0xE5;                     //重装初值
  79   1          TL2 = 0xF5;
  80   1          if ((IRCON & 0x40) ==0x40)
  81   1          {
  82   2             IRCON &= 0xBF;               // TF2清零
  83   2      
  84   2            if(MotorFlag==0)
  85   2              {
  86   3                P05=0;                    //输出2.5ms低电平
  87   3                MotorFlag=1;
  88   3                return;
  89   3              }
  90   2            
  91   2            if(MotorFlag==1)              //输出完毕，关闭定时器2
  92   2              {
  93   3                MotorFlag=0;  
  94   3                P05=1;
  95   3                T2CON =0x00;
  96   3                return;
  97   3              }
  98   2          }
  99   1      }
 100          /*********************************************************************
 101          * 函 数 名： T1Interrupt
 102          * 功能描述： 抓取信号中单个bit
 103          * 函数说明： T1中断处理函数
 104          * 调用函数： 
 105          * 全局变量： PinBit，PinFlag
 106          * 输 入： 无
 107          * 返 回： 无
 108          * 设 计 者：LICHAOFAN 日期：2021-08-13
 109          * 修 改 者：LICHAOFAN 日期：2021-08-13
 110          /*版本：
 111          /**********************************************************************/
 112          void T1Interrupt(void) interrupt ISRTimer1 
 113          {   
 114   1        /********************************定义字节变量***********************/
 115   1          static unsigned char i,PinH,PinL;
 116   1          i++;
C51 COMPILER V9.60.0.0   SYS                                                               08/17/2021 17:42:15 PAGE 3   

 117   1          if(i<10)                            //每100us取一次值，比较高低电平的数量
 118   1          {
 119   2            if((P0&0x10)==0X10)
 120   2              PinH++;
 121   2            else
 122   2              PinL++;
 123   2            
 124   2          }
 125   1          else
 126   1          {
 127   2            i=0;
 128   2            if(PinH>PinL)                     //高电平多则该BIT为1
 129   2            {PinBit=1;
 130   3                  P00=1;
 131   3             }
 132   2            else                              //反之为0
 133   2            {
 134   3              PinBit=0;
 135   3              P00=0;
 136   3            }
 137   2            PinH=0;                           //对计数值清零，将获取成功标志位置1，关闭定时器1
 138   2            PinL=0;
 139   2            PinFlag=1;
 140   2            TR1=0;
 141   2          }
 142   1          
 143   1         
 144   1      }
 145          /*********************************************************************
 146          * 函 数 名： T0Interrupt
 147          * 功能描述： 定时100us，抓取信号跳变，选择t1开启时间，对信号进行处理
 148          * 函数说明： T0中断处理函数
 149          * 调用函数： 
 150          * 全局变量：  PinBit，PinFlag，PinT
 151          * 输 入： 无
 152          * 返 回： 无
 153          * 设 计 者：LICHAOFAN 日期：2021-08-16
 154          * 修 改 者：LICHAOFAN 日期：2021-08-16
 155          /*版本：
 156          /**********************************************************************/
 157          void T0Interrupt(void) interrupt ISRTimer0 
 158          {   /********************************定义字节变量***********************/
 159   1          static  unsigned int PinData,DataError,PinOld;
 160   1          static  unsigned char DataF,TIME,P07Old,P07Time,ZeroOld;
 161   1          /********************************定义位变量*************************/
 162   1          static  bit P07Flag;
 163   1          TIME++;
 164   1          if(TIME>=100)
 165   1          {TIME=0;
 166   2          P00=~P00;}                            //模拟过零信号
 167   1      
 168   1      
 169   1      
 170   1      
 171   1          if((P0&0X10)!=ZeroOld)              //抓取p04下降沿
 172   1          {  
 173   2             if((P0&0X10)==0)                  //若有则接收到红外信号，取下降沿作为触发
 174   2            {
 175   3              
 176   3              TR1=1;                          //若抓到下降沿，则打开t1定时器获取数据
 177   3              DataF++;
 178   3                    
C51 COMPILER V9.60.0.0   SYS                                                               08/17/2021 17:42:15 PAGE 4   

 179   3             }
 180   2            DataError=0;                        
 181   2            ZeroOld=(P0&0x10);                
 182   2            
 183   2          }
 184   1          else
 185   1             DataError++;  
 186   1          if(DataError>=600)                  //当6ms没有收到红外信号，就认为此轮信号接收完成
 187   1          {
 188   2              DataError=0;                      //对计数值清零
 189   2              DataF=0;
 190   2            
 191   2          }
 192   1           
 193   1           
 194   1           
 195   1           
 196   1           
 197   1          if(DataF>=1)                        //读取信号
 198   1          {
 199   2              
 200   2              if(PinFlag==1)                      //当有信号bit被完全获取
 201   2              { 
 202   3                      PinFlag=0;
 203   3                      PinData=(PinData<<1)+PinBit;    //记录
 204   3                  if(DataF==12)                         //当其为最后一位时
 205   3                  {  
 206   4                      if(PinOld==PinData)                 //与上一次收到的值进行比较
 207   4                      {   
 208   5                          PinFlag=0;                      //相同则获取成功
 209   5                          PinT=PinData;
 210   5                          PinData=0;
 211   5                      }
 212   4                      else                                //否则记录下该值
 213   4                          PinOld=PinData;
 214   4                      PinData=0;
 215   4                      DataF=0;
 216   4                      PinFlag=0;
 217   4                          
 218   4                  } 
 219   3                  
 220   3              }
 221   2          
 222   2         
 223   2      
 224   2          }
 225   1          if((P2&0X01)!=P07Old)             //抓取过零信号
 226   1          {  
 227   2              P07Flag=1;
 228   2      //      P05=~P05;
 229   2              P07Old=(P2&0x01);
 230   2            
 231   2          }
 232   1          if(P07Flag==1)                    //当有过零时 计数加一
 233   1          {   
 234   2              P07Time++;
 235   2          }
 236   1          if(P07Time>=Level)                //当计数值大于规定值时，打开T2计时器，输出2.5ms的低电平
 237   1          {   TH2 = 0xFF;
 238   2              TL2 = 0xFE;
 239   2              T2CON =0x01;
 240   2              P07Time=0;
C51 COMPILER V9.60.0.0   SYS                                                               08/17/2021 17:42:15 PAGE 5   

 241   2              P07Flag=0;
 242   2              
 243   2          }
 244   1          
 245   1          
 246   1          
 247   1      }
 248            
 249          /*********************************************************************
 250          * 函 数 名： Delay100us
 251          * 功能描述： 提供100us延时
 252          * 函数说明： 延时函数
 253          * 调用函数： _nop_()
 254          * 全局变量：
 255          * 输 入： unsigned int n
 256          * 返 回： 无
 257          * 设 计 者：LICHAOFAN 日期：2021-08-13
 258          * 修 改 者：LICHAOFAN 日期：2021-08-13
 259          /*版本：
 260          /**********************************************************************/
 261          void Delay100us(unsigned char n)
 262          {
 263   1          unsigned char i, j;
 264   1          i = 0;
 265   1          j = 0;
 266   1          for (i=0; i<n; i++) 
 267   1          {
 268   2              for (j=0; j<2; j++) 
 269   2              {
 270   3               _nop_(); _nop_();  _nop_(); _nop_();
 271   3             _nop_();  _nop_(); _nop_(); _nop_();
 272   3              }
 273   2          }
 274   1      }
 275          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    420    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
